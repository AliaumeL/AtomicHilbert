% LTeX: language=en
%!TEX root = ../atomic.asmart.tex
%
\section{Closure properties}
\label{sec:closure-properties}

In this section, we are interested in listing the operations on sets of
indeterminates equipped with a group action that preserve our \kl{computability
assumptions} and the \kl{well-quasi-ordering} property ensuring that our
\cref{thm:compute-egb} can be applied.  Indeed, it is often tedious to prove
that a given group action $\grp[G] \actson \X$ satisfies the \kl{computability
assumptions} and the \kl{well-quasi-ordering} property, and we aim to provide a
list of operations that preserve these properties, so that simpler examples
(\cref{ex:dlo,ex:eq atoms,ex:dense tree}) can serve as building blocks to model
complex systems.\footnote{This is a common theme in the theory of 
  \kl{well-quasi-ordered} sets, where numerous closure properties are
established \cite[\textbf{TODO}]{SCSC17}.}

For the
remainder of this section, we fix a pair of group actions $\grp[H] \actson \X$
and $\grp[G] \actson \Y$, where $\X$ is equipped with a total order $<_{\X}$
and $\Y$ is equipped with a total order $<_{\Y}$. The constructions that what
we mention in this section were already studied in \cite{GHOLAS24}, via
\cite[Example 10]{GHOLAS24} or \cite[Lemma 9]{GHOLAS24}, but they did not take
into account our stronger requirement that $\gdivleq$ should be a
\kl{well-quasi-ordering} for any \kl{well-quasi-ordered} set $(Y, \leq)$ of
exponents on the monomials. We summarise in \cref{tab:closure-properties}
the
closure properties of the \kl{computability assumptions} and the
\kl{well-quasi-ordering} property, and we give their definitions of the
operations in \cref{def:union,def:product,def:nested product}.

\begin{table}
  \label{tab:closure-properties}
\centering
\caption{Closure properties of the \kl{computability assumptions} and \kl{well-quasi-ordering} property.}
\begin{tabular}{l|l|l|l|l}
  \toprule
  \textbf{Name} &
  \textbf{Group action} & \textbf{Effective} & \textbf{WQO} & \textbf{Reference} \\
  \midrule
  Sum & $\grp[G] \times \grp[H] \actson \X \ordplus \Y$ &  Yes & Yes & \cref{def:union} \\
  Product &  $\grp[G] \times \grp[H] \actson \X \ordtimes \Y$ & Yes & No & \cref{def:product} \\
  Lex. Product & $\grp[G] \lexGroupAction \grp[H] \actson \X \ordtimes \Y$ & Yes & Yes & \cref{def:nested product} \\
  \bottomrule
\end{tabular}
\end{table}

\begin{definition}[Sum action]\label{def:union}
  Given $(\gelem[\pi], \gelem[\sigma]) \in \grp[G] \times \grp[H]$ 
  and $z \in \X \ordplus \Y$, we define the action
  $(\gelem[\pi], \gelem[\sigma])(z)$ as
  $\gelem[\pi](z)$ if $z \in \X$ and $\gelem[\sigma](z)$ if $z \in \Y$.
  This action is called the \reintro{sum action} of $\grp[G]$ and $\grp[H]$ on $\X \ordplus \Y$.
\end{definition}

\begin{definition}[Product action]\label{def:product}
  Given $(\gelem[\pi], \gelem[\sigma]) \in \grp[G] \times \grp[H]$ and $(x,y) \in \X \ordtimes \Y$, we define the \intro{product action} of $\grp[G]$ and $\grp[H]$ on $\X \ordtimes \Y$ as
  $(\gelem[\pi], \gelem[\sigma])\cdot (x,y)$ as $(\gelem[\pi](x), \gelem[\sigma](y))$.
  Note that the ordering of $\X \ordtimes \Y$ is preserved by this action.
\end{definition}

\begin{definition}[Lex. Product Action]\label{def:nested product}
  Let $\grp[G] \lexGroupAction \grp[H]$ be the group whose elements are of the form 
  $(\gelem,\seqof{\gelem[\sigma]^{x}}[x\in\X])$, where 
  $\gelem[\sigma]_{x} \in \grp[H]$ for every $x\in\X$, and where the multiplication
  is defined as 
  $(\gelem_1,(\gelem[\sigma]_1^{x})_{x\in\X})(\gelem_2,(\gelem[\sigma]_2^{x})_{x\in\X})
  = (\gelem_1\gelem_2, (\gelem[\sigma]_1^{\gelem_2(x)}\gelem[\sigma]_2^x)_{x\in\X})$.
  The \intro{lexicographic product action} of $\grp[G]$ and $\grp[H]$ on $\X \ordtimes \Y$ is defined as
  $\grp[G] \lexGroupAction \grp[H]$ on $\X \ordtimes \Y$ is defined as
  $(\gelem,(\gelem[\sigma]^{x})_{x\in\X})\cdot(x',y') = 
  (\gelem\cdot x', \gelem[\sigma]^{x'}\cdot y')$ for every $(x',y')\in\X \ordtimes \Y$.
Essentially,
each element $x\in\X$ carries its own copy $\{x\}\times\Y$ of the structure $\Y$,
and different copies of the structure $\Y$ can be permuted independently.
\end{definition}
%
\begin{lemma}\label{lem:closure-properties-wqo}
If $(\mon[Q]{\X}, \gdivleq[\grp[G]])$ and $(\mon[Q]{\Y}, \gdivleq[\grp[H]])$ are \kl{WQOs},
then $(\mon[Q]{\X \ordplus \Y}, \gdivleq[\grp[G] \times \grp[H]])$ and $(\mon[Q]{\X\uplus\Y}, \gdivleq[\grp[G]\otimes\grp[H]])$ are also \kl{WQOs}.
\end{lemma}
%
\begin{proof}
The \kl{divisibility up to $\grp[G] \times \grp[H]$} order is essentially the product of the orders $\gdivleq[\grp[G]]$ and $\gdivleq[\grp[H]]$,
hence is a \kl{WQO} if both orders are \kl{WQOs} \cite[Lemma 1.5]{SCSC17}.
For, $(\mon[Q]{\X\uplus\Y}, \gdivleq[\G\otimes\calH])$ it follows from \cite[Lemma 9]{GHOLAS24}.
\end{proof}
%
\begin{lemma}\label{lem:product-not-wqo}
If $(\mon[Q]{\X \ordtimes \Y}, \gdivleq[\grp[G] \times \grp[H]])$ is not a \kl{WQO} even if both $\X$ and $\Y$ are infinite.
\end{lemma}
%
\begin{proof}
We restate the antichain given in \cite[Example 10]{GHOLAS24}.
Let $\{x_1,x_2,\dots\}$ and $\{y_1,y_2,\dots\}$ be infinite subsets of $\X$ and $\Y$ respectively.
For $n = 3,4,\dots$, let $\monelt{c}_n$ be the monomial
\[
\monelt[c]_n = (x_1,y_1)(x_1,y_2)(x_2,y_2)(x_2,y_3)\ldots(x_n,y_n)(x_n,y_1) \ .
\]
Then $\setof{\monelt[c]_n}{n = 3,4,\dots}$ is an infinite antichain.
\end{proof}
%
\begin{lemma}\label{lem:closure-properties-comp}
If $\grp[G]\actson\X$ and $\grp[H]\actson\Y$ satisfy our \kl{computability assumptions},
then so do $(\grp[G] \times \grp[H])\actson (\X \ordplus \Y)$ and $(\grp[G] \otimes \grp[H])\actson (\X \times \Y)$.
\end{lemma}
%
\begin{proof}
\todo[inline]{for aliaume: cleanup this}
First we show that they are compatible with a computable linear order.
The \kl{sum action} preserves the order $<_{\X \ordplus \Y}$ defined as
\[
u < v \quad\iff\quad \text{either $u\in\X$ and $v\in\Y$, or $u < v \in \X$, or $u < v \in \Y$}\ .
\]
If $\G\actson\X$ and $\calH\actson\Y$ preserves the linear orders $<_{\X}$ and $<_{\Y}$, respectively,
then $\G\otimes\calH \actson \X\times\Y$ preserves the lexicographic linear order on $\X\times\Y$ defined as
\[
(x,y) <_{\ell ex} (x',y')\quad\text{if}\quad
\text{$x <_{\X} x'$, or $x = x'$ and $y <_{\Y} y'$.}
\]

Now we show point (2) hold in our \kl{computability assumptions} holds for $(\grp[G] \times \grp[H])\actson (\X \ordplus \Y)$ and $(\grp[G] \otimes \grp[H])\actson (\X \times \Y)$.
The proofs can be extended to show that point (3) hold as well.

Every tuple of element $z_1\dots z_n$ in $(\X + \Y)^*$ can be written as a pair  of elements $z_{\X} = z_{i_1}\dots z_{i_k}$ and $z_{\Y} = z_{j_1}\dots z_{j_{\ell}}$ of elements respectively in $\X^*$ and $\Y^*$, for some partition .
Two elements $z_1\dots z_n$ and $z'_1\dots z'_n$ are in the same orbit if and only if $z_{\X} = z_{i_1}\dots z_{i_k}$ and $z'_{\X} = z'_{i'_1}\dots z'_{i'_{k'}}$,
and $z_{\Y} = z'_{j'_1}\dots z_{j'_{\ell'}}$ and $z'_{\Y} = z'_{j'_1}\dots z'_{j'_{\ell'}}$ are respectively in the same orbits,
$\{i_1,\dots,i_k\} = \{i'_1,\dots,i'_{k'}\}$ and $\{j'_1,\dots,j'_{\ell'}\} = \{j'_1,\dots,j'_{\ell'}\}$.

From an element $(x_1,y_1)\dots (x_n,y_n)$ we can create a list of words in $u_1,\dots,u_n \in \Y^*$ by defining $u_i = y_{j_1}\dots y_{j_k}$ such that $\{j_1 < \dots < j_k\} = \setof{j\in\{1,\dots,n}{x_j = x_i}$.
Two elements $(x_1,y_1)\dots (x_n,y_n)$ and $(x'_1,y'_1)\dots (x'_n,y'_n)$ in $(\X \times \Y)^*$ are in the same orbit under the action of $(\grp[G] \times \grp[H])$ if and only if $x_1\dots x_n$ and $x'_1 \dots x'_n$ are in the same orbit,
and $u_i$ and $u'_i$ are in the same orbit for every $i = 1,\dots,n$.
We can extend this idea
\end{proof}
%
\section{Applications}
\label{sec:applications}

\paragraph{Polynomial computations.} \AP The fact that (finite control) systems
performing polynomial computations can be verified follows from the theory of
\kl{Gröbner bases} on finitely many indeterminates \cite{MULSEI02,BEDUSHWO17}.
There were also numerous applications to automata theory, such as deciding
whether a weighted automaton could be determinised (resp. desambiguated)
\cite{BESM23,PUSM24}. We refer the readers to a nice survey recapitulating the
successes of the ``Hilbert method'' automata theory \cite{BOJAN19}. A natural
consequence of the effective computations of \kl{equivariant Gröbner bases} is
that one can apply the same decision techniques to \emph{orbit finite
polynomial computations}. For simplicity and clarity, we will focus on
\kl{polynomial automata} without states or zero-tests \cite{BEDUSHWO17}, but
the same reasoning would apply to more general systems as we will discuss in
\cref{rem:topological-wsts}.


\AP Before discussing the case of orbit finite polynomial automata, let us
recall the setting of \kl{polynomial automata} in the classical case, as
studied by \cite{BEDUSHWO17}, with techniques that dates back to
\cite{MULSEI02}. A \intro{polynomial automaton} is a tuple $A \defined (Q,
\Sigma, \delta, q_0, F)$, where $Q = \K^n$ for some finite $n \in \N$, $\Sigma$
is a finite alphabet, $\delta \colon Q \times \Sigma \to Q$ is a transition
function such that $\delta(\cdot,a)_i$ is a polynomial in the indeterminates
$q_1, \dots, q_n$ for every $a \in \Sigma$ and every $i \in \set{1, \dots, n}$,
$q_0 \in Q$ is the initial state, and $F \colon Q \to \K$ is a polynomial
function describing the final result of the automaton. The \intro{zeroness
problem for polynomial automata} is the following decision problem: given a
\kl{polynomial automaton} $A$, is it true that for all words $w \in \Sigma^*$,
the polynomial $F(\delta^*(q_0, w))$ is zero? It is known that the \kl{zeroness
problem for polynomial automata} is decidable \cite{BEDUSHWO17}, using the
theory of \kl{Gröbner bases} on finitely many indeterminates. 


\newcommand{\toequiv}{\stackrel{\text{\tiny{eq}}}{\to}}

\AP Let us now propose a new model of computation called \kl{orbit finite
polynomial automata}, and prove an analogue decidability result. Let us fix an
\kl{effectively oligomorphic} action $\group \actson \Indets$, such that there
exists finitely many indeterminates $V \subfin \Indets$ such that $\group$ acts
as the identity on $V$. Given such a function $f \colon \Indets \to \K$, and
given a polynomial $p \in \poly{\K}{\Indets}$, we write $p(f)$ for the
evaluation of $p$ on $f$, that belongs to $\K$. Let us emphasis that the model
is purposely designed to be simple and illustrate the usage of \kl{equivariant
Gröbner bases}, and not meant to be a fully-fledged model of computation.

\begin{definition}
  \label{def:orbit-finite-polynomial-automaton}
  An \intro{orbit finite polynomial
  automaton} is a tuple $A \defined (Q, \delta, q_0, F)$, where $Q =
  \Indets \to \K$, $q_0 \in Q$ is a function that is non-zero for finitely
  many indeterminates, $\delta \colon
  \Indets \times \Indets \toequiv \poly{\K}{\Indets}$ 
  is a
  polynomial update function, and $F \in \poly{\K}{V}$ is a polynomial 
  computing the result of the automaton. 

  Given a letter $a \in \Indets$ and a
  state $q \in Q$, the updated state $\delta^*(a,q)  \in Q$ is defined as the function from
  $\Indets$ to $\K$ defined by $\delta^*(a,q) \colon x \mapsto \delta(a,x)( q )$.
  The update function is naturally extended to words. Finally, the
  output of an \kl{orbit finite polynomial automaton} on a word $w \in \Indets^*$
  is defined as $F(\delta^*(w,q_0))$.
\end{definition}

\AP \kl{Orbit finite polynomial automata} can be used to model programs that
read a string $w \in \Indets^*$ from left to right, having as internal state a
dictionary of type \texttt{dict[indet, number]}, which is updated using
polynomial computations. As for \kl{polynomial automata}, the
\intro(ofpa){zeroness problem} for orbit finite polynomial automata is the
following decision problem: decide if for every input word $w$, the output
$F(\delta^*(w, q_0))$ is zero.

\begin{theorem}
  \label{cor:orbit-finite-polynomial-automata-zeroness}
  Let $\Indets$ be a set of indeterminates that satisfies the
  \kl{computability assumptions} and such that $(\mon[Y]{\Indets}, \gdivleq)$ is a
  \kl{well-quasi-ordering}, for every \kl{well-quasi-ordered} set $(Y, \leq)$.
  Then, the \kl(ofpa){zeroness problem} is decidable for \kl{orbit finite polynomial automata}.
\end{theorem}
\begin{proof}
  Let $A = (Q, \delta, q_0, F)$ be an \kl{orbit finite polynomial
  automaton}. Following the classical \emph{backward procedure} for such
  systems, we will compute a sequence of sets $E_0 \defined \setof{ q \in Q }{
  F(q) = 0 }$, and $E_{i+1} \defined \mathrm{pre}^\forall(E_i) \cap E_i$, where
  $\mathrm{pre}^\forall(E)$ is the set of states $q \in Q$ such that for every
  $a \in \Sigma$, $\delta^*(q,a) \in E$. We will prove that the sequence of
  sets $E_i$ stabilises, and that it is computable. As an immediate
  consequence, it suffices to check that $q_0 \in E_{\infty}$, where $E_\infty$
  is the limit of the sequence $(E_i)_{i \in \N}$, to decide the
  \kl(ofpa){zeroness problem}.

  The only idea of the proof is to notice that all the sets $E_i$ are
  representable as zero-sets of \kl{equivariant ideals} in
  $\poly{\K}{\Indets}$, allowing us to leverage the effective computations of
  \cref{cor:equivariant-ideals-computations}. Given a set $H$ of polynomials,
  we write $\mathcal{V}(H)$ the collections of states $q \in Q$ such that $p(q)
  = 0$ for all $p \in H$.
  It is easy to see that $E_0 = \mathcal{V}(\set{F}) = \mathcal{V}(\idl_0)$,
  where $\idl_0$ is the \kl{equivariant ideal} generated by $F$, since 
  $F \in \poly{\K}{V}$ and $V$ is invariant under the action of $\group$.
  Furthermore, assuming that $E_i = \mathcal{V}(\idl_i)$, we can
  see that 
  \begin{align*}
    \mathrm{pre}^\forall(E_i) 
    & = \setof{ q \in Q }{ \forall a \in \Sigma, \delta^*(a,q) \in E_i } \\
    & = \setof{ q \in Q }{ \forall a \in \Sigma, \forall p \in \idl_i, p(\delta^*(a,q)) = 0 } \\
    & = \setof{ q \in Q }{ \forall p' \in \idl[J], p'(q) = 0 }
  \end{align*}
  Where, the \kl{equivariant ideal} $\idl[J]$ is generated by the
  polynomials $\mathrm{pullback}(p,a) \defined p [ x \mapsto \delta(a,x)]$
  for every pair $(p, a) \in \idl_i \times \Sigma$. 
  As a consequence, we have $E_{i+1} = \mathcal{V}(\idl_{i+1})$, where
  $\idl_{i+1} = \idl_i + \idl[J]$.
  Because the sequence $\seqof{ \idl_i }[ i \in \N]$ is increasing, and thanks
  to the \kl{equivariant Hilbert basis property} of $\poly{\K}{\Indets}$, there
  exists an $n_0 \in \N$ such that $\idl_{n_0} = \idl_{n_0 + 1} = \idl_{n_0 +
  2} = \cdots$. In particular, we do have $E_{n_0} = E_{n_0 + 1} = E_{n_0 + 2}
  = \cdots$.

  Let us argue that we can compute the sequence $\idl_i$.
  First,  $\idl_0 = \EqIdlGen{F}$ is finitely represented.
  Now, 
  given an \kl{equivariant ideal} $\idl$, represented by an \kl{orbit finite}
  set of generators $H$,
  we can compute the \kl{equivariant ideal} $\idl[J]$ generated by the
  polynomials $\mathrm{pullback}(p,a) \defined p [ x_i \mapsto \delta(a)(x_i)]$
  for every pair $(p, a) \in H \times \Sigma$. Indeed, $H \times \Sigma$ is
  \kl{orbit finite}, and the function $\mathrm{pullback}$ is
  computable and \kl(func){equivariant}: given $\gelem \in \group$, we can
  show that
  \begin{align*}
    \gelem \cdot \mathrm{pullback}(p, a) & = 
    \gelem \cdot (p [ x_i \mapsto \delta(a,x_i)]) & \text{ by definition }\\
                                                  & = p [ x_i \mapsto (\gelem \cdot \delta(a, x_i))] 
                                                  & \text{ $\gelem$ acts as a morphism } \\
    & = p [ x_i \mapsto \delta(\gelem \cdot a, \gelem \cdot x_i))] 
    & \text{ $\delta$ is \kl(func){equivariant} } \\
    & = (\gelem \cdot p) [ x_i \mapsto \delta(\gelem \cdot a, x_i)] 
    & \text{ definition of substitution }
    \\
    & = \mathrm{pullback}(\gelem \cdot p, \gelem \cdot a).
    & \text{ by definition }
  \end{align*}
  
  Finally, one can detect when the sequence stabilises, by checking whether
  $\idl_i = \idl_{i+1}$, which is decidable because the
  \kl{equivariant ideal membership problem} is decidable 
  by \cref{thm:compute-egb}.

  To conclude, it remains to check whether $q_0 \in E_\infty$,
  which amounts to check that $q_0 \in \mathcal{V}(\idl_\infty)$.
  This is equivalent to checking whether for every element $p \in \Basis$
  where $\Basis$ is an \kl{equivariant Gröbner basis} of $\idl_\infty$, we have
  $p(q_0) = 0$, which can be done by enumerating relevant orbits.
\end{proof}

The \kl{orbit finite polynomial automata} model could be extended to allow for
inputs of the form $\Indets^k$ for some $k \in \N$, or even be recast in the
theory of nominal sets \cite{BOJAN16inf}. Furthermore, leveraging
\cref{lem:closure-properties-order,lem:closure-properties-wqo}, one can also
reduce the equivalence problem for \kl{orbit finite polynomial automata} to the
\kl(ofpa){zeroness problem}, by considering the \kl{sum action} on the
registers to compute the difference of the two results. We leave a more
detailed investigation of the generalisation of \kl{polynomial automata} to the
orbit finite setting for future work.


\begin{remark}
  \label{rem:topological-wsts}
  The proof of \cref{cor:orbit-finite-polynomial-automata-zeroness} can be
  recast in the more general setting of 
  \intro{topological well-structured transition system}, that were introduced by
  Goubault-Larrecq in \cite{JGL07}, who noticed that the pre-existing notion of
  \emph{Noetherian space} could serve as a topological generalisation of
  \kl{Noetherian rings} (where ideal-based method can be applied),
  and 
  \kl{well-quasi-orderings}, for which the celebrated decision procedures on
  \emph{well-structured transition systems} can be applied \cite{ABDU96}. In particular,
  Goubault-Larrecq used such systems to verify properties of \emph{polynomial
  programs} computing over the complex numbers, that can communicate over lossy
  channels using a finite alphabet \cite{JGL10}. 
  Because of \cref{cor:equivariant-ideals-computations}, we do have an 
  effective way to compute on the topological spaces at hand, 
  and therefore we can apply the theory of
  \kl{topological well-structured transition systems} to verify systems
  such as \emph{orbit finite polynomial automata communicating using a finite alphabet
  over lossy channels}.
  We refer to \cite[Chapter 9]{JGL13} for a survey on the theory of 
  Noetherian spaces.
\end{remark}



\todo[inline]{ for arka: fill this. 
  The classical model of Petri nets [cite]
  was extended to account for arbitrary data attached to tokens 
  to form what is called data petri nets [cite]. We will not 
  discuss the precise definitions of these models, but 
  point out  
  that a reversible data Petri net is exactly what is called a 
  \kl{monomial rewriting system} \cite[Section 8]{GHOLAS24}.
  Because reachability in such rewriting systems can be decided 
  using \kl{equivariant ideal membership} queries \cite[Theorem 64]{GHOLAS24},
  we can use \cref{thm:compute-egb} and \cref{lem:reducts-equiv-hilbert} to
  show \cref{cor:rev data VAS}. Note that \kl{monomial rewrite systems}
  will be at the center of our undecidability results in
  \cref{sec:undecidability}.
}
\paragraph{Reachability problem of symmetric data Petri nets.}
Define a Petri net with data $\group\actson\Indets$ to be a Petri net which uses elements from $\Indets$ to label its tokens,
and its transitions are invariant under the action of $\group$.
As observed in \cite[Section 8]{GHOLAS24},
a reversible data Petri nets are same as a monomial rewrite system.
Using \Cref{thm:compute-egb}, \Cref{lem:reducts-equiv-hilbert} and \cite[Theorem 64]{GHOLAS24} we can get the following corollary:
%
\begin{corollary}\label{cor:rev data VAS}
  For every \kl{nicely orderable} group action $\group\actson\Indets$,
  the reachability problem for reversible Petri nets with data in $\Indets$ is decidable.
\end{corollary}



\paragraph{Orbit-finite systems of equations} The classical theory of solving
finite systems of linear equations has been generalised to the infinite setting
by \todo{cite}. In this setting, one considers an \kl{effectively oligomorphic}
group action $\group\actson\Indets$, and the vector space $\lin(\Indets^n)$
generated by the indeterminates $\Indets^n$ over $\K$. An orbit-finite
system of equations asks whether a given vector $u \in \lin(\Indets^n)$ is in
the vector space generated by an \kl{orbit-finite} set of vectors $V$ in
$\lin(\Indets^n)$ \cite[Section 9]{GHOLAS24}. It has been shown that the
solvability of these systems of equations reduces to the \kl{equivariant ideal
membership problem} \cite[Theorem 68]{GHOLAS24}, and as a consequence of this
reduction and \Cref{thm:compute-egb,lem:reducts-equiv-hilbert} we get that:

\begin{corollary}\label{cor:lin solv}
  For every \kl{nicely orderable} group action $\group\actson\Indets$,
  the solvability problem for orbit-finite systems of equations
  is decidable.
\end{corollary}
