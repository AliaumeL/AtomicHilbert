% LTeX: language=en
\section{Computing the Equivariant Gröbner Basis}
\label{sec:equivariant-grobner-basis}

The goal of this section is to strengthen the results of \cref{sec:algorithm},
and instead of being able to answer to the \kl{equivariant ideal membership
problem}, to compute an \kl{equivariant Gröbner basis} of an equivariant ideal.
Let us recall that a Gröbner basis is known to exist, but that it's
computability was an open question of \cite{GHOLAS24}.

The proof will closely follow the one of \cref{sec:algorithm}, where one starts
from a generating set $H$, and constructs a new set $H'$ together with a group
action, over which one computes a \kl{weak Gröbner basis} (\cref{sec:weakgb}).
The result is then used to derive an \kl{equivariant Gröbner basis} of the
\kl{equivariant ideal generated by} $H$. Informally, one wants to 
apply the technique of isolating finite sets of variables \emph{uniformly},
that is, compute \kl{weak Gröbner bases} for every possible fixed 
finite subset of variables. 


Let us fix a set $\Indets$ of indeterminates equipped with a total ordering
$\varleq$. We define $\IndetsCol \defined \Indets + \Indets$, that is, the
disjoint union of two copies of $\Indets$, ordered. It will be useful to refer
to the first copy (lower copy) and the second copy (upper copy), noting the
isomorphism between $\IndetsCol$ and $\set{\mathsf{first}, \mathsf{second}}
\times \Indets$, ordered lexicographically, where $\mathsf{first} <
\mathsf{second}$. We will also define $\forgetCol \colon \IndetsCol \to
\Indets$ that maps a colored variable to its underlying variable.
Beware that $\forgetCol$ is not an order preserving map.
We extend $\forgetCol$ as a morphism from polynomials in
$\poly{\K}{\IndetsCol}$ to polynomials in $\poly{\K}{\Indets}$.

Given a subset $V \subfin \Indets$, we build the injection $\colorWith{V}
\colon \Indets \to \IndetsCol$ that maps variables $x$ in $V$ to
$(\mathsf{fisrt}, x)$, and variables $x$ not in $V$ to $(\mathsf{second}, x)$.
Again, we extend these maps as morphisms from $\poly{\K}{\Indets}$ to
$\poly{\K}{\IndetsCol}$. We say that a polynomial $p \in \poly{\K}{\IndetsCol}$
is \intro{$V$-compatible} if $p \in \colorWith{V}(\poly{\K}{\Indets})$.

\begin{lemma}
  \label{lem:v-saturation-computable}
  Let $H$ be an \kl{orbit finite} subset of $\poly{\K}{\Indets}$.
  Then, $\freeColor(H) \defined \bigcup_{V \subfin \Indets} \colorWith{V}(H)$
  is a computable \kl{orbit finite} subset of $\poly{\K}{\IndetsCol}$.
\end{lemma}


We are now ready to write our algorithm to compute 
an \kl{equivariant Gröbner basis}.

\begin{algorithm}
    \caption{Computing \kl{equivariant Gröbner bases}}
    \label{alg:stronggb}
    \KwIn{An orbit finite set $H$ of polynomials}
    \KwOut{An orbit finite set $\Basis$ that is a \kl{equivariant Gröbner basis} of
      $\EqIdlGen{H}$}
    \Begin{
        $H_C \gets \freeColor(H)$\;
        $\Basis_C \gets \mathsf{weakgb}(H_C)$\;
        $\Basis \gets \forgetCol(\Basis_C)$\;
        \Return{$\Basis$}\;
    }
\end{algorithm}

To prove the correctness of our algorithm, let us first argue
that one can indeed compute the \kl{weak Gröbner basis} algorithm.

\begin{lemma}
  \label{lem:colored-hypothesis-sat}
  Assume that $(\Indets, \varleq, \group)$
  is \kl{effectively oligomorphic},
  and that $(\mon[\omega + \omega]{\Indets}, \gdivleq)$
  is a \kl{well-quasi-order}.
  Then,
  $\IndetsCol$ with its ordering and the 
  action of $\group$ acting on both components 
  simultaneously is \kl{effectively oligomorphic},
  and $(\mon{\IndetsCol}, \gdivleq)$ is a
  \kl{well-quasi-ordered} set.
\end{lemma}

Now, let us argue that the result of our algorithm
is a generating set of the desired ideal, which follows
from the fact that $\forgetCol$ and $\colorWith{\cdot}$
are morphisms that preserve variable names.

\begin{lemma}
  \label{lem:correct-gen-set}
  Let $H$ be an \kl{orbit finite} subset of $\poly{\K}{\Indets}$,
  then the result of \cref{alg:stronggb}
  is an \kl{orbit finite} generating set
  of $\EqIdlGen{H}$.
\end{lemma}
\begin{proof}
  Let us remark that $\forgetCol{\freeColor(H)} = H$.
  Because we know that $\mathsf{weakgb}{\freeColor(H)}$
  generates the same ideal as $\freeColor(H)$,
  and since $\forgetCol$ is a morphism,
  we conclude that 
  $\forgetCol(\mathsf{weakgb}{\freeColor(H)})$
  generates the same ideal as
  $\forgetCol(\freeColor(H)) = H$.
\end{proof}

Let us now prove that the resulting set in indeed
an \kl{equivariant Gröbner basis} of $\EqIdlGen{H}$.
To notice this, we will first prove one claim
regarding the computation of $\mathsf{weakgb}$.

\begin{lemma}
  \label{lem:weakgb-color-compatible}
  Let $H \subseteq \poly{\K}{\Indets}$
  and $V \subfin \Indets$.
  Let $H_\star \defined \freeColor(H)$
  and $H_V \defined \colorWith{V}(H)$.
  Then, 
  $\mathsf{weakgb}(H_V) \subseteq 
  \mathsf{weakgb}(H_\star)$,
  and $\mathsf{weakgb}(H_V)$ is 
  a \kl{$V$-compatible} subset.

  \begin{equation*}
   \mathsf{weakgb}(H_V)
   =
   \colorWith{V}(\forgetCol(\mathsf{weakgb}(H_\star)))
  \end{equation*}
\end{lemma}
\begin{proof}
  Let us first remark that 
  $\mathsf{weakgb}(H_V)$ is 
  a \kl{$V$-compatible} subset. To that end,
  notice that if $p$ and $q$ are \kl{$V$-compatible},
  then so is $\spoly{p}{q}$ by definition.
  Furthermore,
  if $p$ reduces to $q$, and $p$ is \kl{$V$-compatible},
  then $q$ is too, because its variables are included in
  those of $p$. Finally, it is clear that 
  the resulting set is
  \kl{$V$-compatible} by induction.

  For the inclusion, 
  we prove it by induction on the computation of the algorithm,
  the base case being trivial. 
  The set of \kl{$S$-polynomials} are clearly included,
  and the only thing to remark is that 
  if a \kl{$V$-compatible} polynomial is reducible
  in the freely colored setting, then it must be reducible
  by \kl{$V$-compatible} polynomials. 
\end{proof}

We now have all the ingredients to conclude our proof
\begin{lemma}
  \label{lem:strong-gb-correct}
  \Cref{alg:stronggb} is correct.
\end{lemma}
\begin{proof}
  Let $p \in \EqIdlGen{H}$,
  $H_\star = \freeColor(H)$,
  $V \defined \dom(p)$,
  $H_V \defined \colorWith{V}(H)$.
  We let $\Basis_\star = \mathsf{weakgb}(H_\star)$,
  and $\Basis_V = \mathsf{weakgb}(H_V)$.
  Finally, $\Basis = \forgetCol(\Basis_\star)$.

  Because of 
  \cref{lem:correct-gen-set}
  $p \in \EqIdlGen{\Basis}$,
  hence, one can write
  $p = \sum_{i \in I} a_i \monelt_i h_i$, 
  where $a_i \in \K$, $\monelt_i \in \mon{\Indets}$
  and $h_i \in \Basis$.

  Now, we obtain, thanks to 
  \cref{lem:weakgb-color-compatible}, the following
  equation:
  \begin{equation*}
    \colorWith{V}(p) \in 
    \IdlGen{\colorWith{V}(\Basis)}
    =
    \IdlGen{\colorWith{V}(\forget(\mathsf{weakgb}(H_\star)))}
    =
    \IdlGen{\mathsf{weakgb}(H_V)}
    = 
    \IdlGen{\Basis_V}
  \end{equation*}

  Because $\Basis_V$ is a 
  \kl{weak Gröbner basis},
  there exists an element $h \in \Basis_V$
  such that
  $\lm(h)$ divides $\lm(\colorWith{V}(p))$,
  and indeterminates of $h$ are smaller or 
  equal to the indeterminates of $\colorWith{V}(p)$.
  Since all the indeterminates of the latter
  are all colored with $\mathsf{first}$, this means
  that all variables in $h$ must be labelled with 
  $\mathsf{first}$. Because $h$ is a \kl{$V$-compatible}
  polynomial, this means that $h$ actually only uses
  variables from $\colorWith{V}(p)$.

  A fortiori, $\forget(h)$ only uses variables in $V$,
  and $\lm(h)$ divides $\lm(p)$. We conclude
  that $\Basis$ is an \kl{equivariant Gröbner basis}.
\end{proof}


