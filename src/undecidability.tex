%!TEX root = ../atomic.asmart.tex
% LTeX: language=en
\section{Undecidability Results}
\label{sec:undecidability}

In this section, we will show that under certain conditions, the
\kl{equivariant ideal membership problem} is undecidable. We aim to show that
it is the case when we assume the usual effectiveness conditions on the group
action, but we do not assume that $(\mon{\Indets}, \gdivleq)$ is a
well-quasi-ordering. Beware though that there are some pathological cases where
the \kl{equivariant ideal membership problem} is undecidable even when
$(\mon{\Indets}, \gdivleq)$ is not a well-quasi-ordering, as illustrated by the
following \cref{ex:non-wqo-undecidable}.

\begin{example}
  \label{ex:non-wqo-undecidable}
  Let $\Indets = \{x_1, x_2, \ldots\}$ be an infinite set of indeterminates,
  and let $\group$ be trivial group acting on $\Indets$.
  Then, the \kl{equivariant ideal membership problem} is decidable.
\end{example}
\begin{proof}
  Because the group is trivial, whenever one provides a finite set
  $H$ of generators of an \kl{equivariant ideal} $I$, one can
  in fact work in $\poly{\K}{V}$, where $V$ is the set of indeterminates
  that appear in $H$.
  Then, the \kl{equivariant ideal membership problem} is reduces to 
  the \kl{ideal membership problem} in $\poly{\K}{V}$, which is decidable.
\end{proof}

\subsection{Interpreting Paths}
\label{subsec:paths}

\todo[inline]{
  This definition of path is not practical: it does not talk about what is happening
  outside the path at all.
}
In this section, we will assume that the set of indeterminates $\Indets$
contains an infinite path $P \defined \seqof{x_i}[i \in \N] \subseteq \Indets$,
that is, a set of indeterminates such that $\group$ acts on $\Indets$ as a
translation of the indices, that is, for all $\gelem \in \group$ and for all
segments $J \defined [k,l] \subfin \N$, we have such that $\gelem \cdot x_j
\subseteq P$ for all $j \in J$, there exists $n \in \N$ such that $\gelem \cdot
x_j = x_{j + n}$ for all $j \in J$.

The following two lemmas show that the existence of an infinite path is a
sufficient condition to ensure that $(\mon{\Indets}, \gdivleq)$ is not a
\kl{well-quasi-ordering}, and that it is close to being a sufficient condition
in the case of finite relational structures.

\begin{lemma}
  If $\Indets$ contains an infinite path $P$, then the
  $(\mon{\Indets}, \gdivleq)$ is not a \kl{well-quasi-ordering}.
\end{lemma}
\begin{proof}
  Consider the monomials
  $x_0^2 x_1 \cdots x_n x_{n+1}^2$ for all $n \in \N$.
  They are pairwise incomparable with respect to $\gdivleq$,
  hence form an infinite antichain.
\end{proof}


\begin{conjecture}[Schmitz]
  Let $\mathcal{C}$ be a class of finite relational sturctures
  that is not $2$-well-quasi-ordered, then 
  there exists in existential formula $\phi(x,y)$ that defines
  arbitrarily long paths in the structures of $\mathcal{C}$.
\end{conjecture}

\begin{corollary}
  Assume that $\mathbb{A}$ is an infinite relational structure,
  and that its age is not $2$-well-quasi-ordered.
  Then, there exists an infinite structure $\mathbb{B}$
  that is elementarily equivalent to $\mathbb{A}$,
  and where an existential formula $\phi(x,y)$ defines
  an infinite path.
\end{corollary}
\begin{proof}
  It suffices to use the conjecture above and the compactness theorem 
  for first-order logic.
\end{proof}

\begin{corollary}
  Let $\mathbb{A}$ be an infinite relational structure,
  and assume that its age is not $2$-well-quasi-ordered.
  Then, if $\Indets$ is the elements of $\mathbb{A}$,
  and $\group$ is the automorphism group of $\mathbb{A}$,
  then one can assume that $\mathbb{A}$
  contains in infinite path.
\end{corollary}
\begin{proof}
  We first replace $\mathbb{A}$ by an infinite structure
  $\mathbb{B}$ that is elementarily equivalent to $\mathbb{A}$.
  Because we only ever write finite sets of indeterminates,
  equivariant ideal membership problems are the same in $\mathbb{A}$
  and $\mathbb{B}$.
  Finally, because of $\phi(x,y)$, we can add a binary relation to 
  $\mathbb{B}$ that defines an infinite path, without changing the
  \kl{equivariant ideal membership problem}.
\end{proof}

\begin{definition}
  \label{def:mon-rewrite-system}
  A \intro{monomial rewrite system} is a finite set of pairs of the form
  $\set{\monelt, \monelt'}$ where $\monelt, \monelt' \in \mon{\Indets}$.
  The \intro{monomial reachability problem} is the problem of deciding whether
  there exists a sequence of rewrites that transforms $\monelt_s$ into $\monelt_t$
  using the rules of a monomial rewrite system $R$, where
  a \intro{rewrite step} is a pair of the form
  \begin{equation*}
    \monelt[n] (\gelem \cdot \monelt)
    \leftrightarrow_R 
    \monelt[n] (\gelem \cdot \monelt')
    \text{ if } \set{\monelt, \monelt'} \in R
    \text{ and } \gelem \in \group
    \quad .
  \end{equation*}
\end{definition}


\begin{lemma}
  \label{lem:mon-rewrite-red-membership}
  One can solve the \kl{monomial reachability problem} in polynomial time
  provided that one can solve the \kl{equivariant ideal membership problem}.
\end{lemma}
\begin{proof}
  Let $R$ be a monomial rewrite system, and let $\monelt_s, \monelt_t \in
  \mon{\Indets}$ be two monomials. We can encode the problem of deciding whether
  $\monelt_s$ can be rewritten into $\monelt_t$ using the rules of $R$ as an
  instance of the \kl{equivariant ideal membership problem} as follows:
  \begin{itemize}
    \item Let $H$ be the set of all polynomials of the form $\monelt - \monelt'$
      for all pairs
      $(\monelt, \monelt') \in R$.
    \item Then, we ask whether $\monelt_s - \monelt_t$ belongs to the ideal generated by $H$.
  \end{itemize}

  It is clear that if $\monelt_s$ can be rewritten into $\monelt_t$ using the
  rules of $R$, then $\monelt_s - \monelt_t$ belongs to the equivariant ideal generated by
  $H$. Conversely, if $\monelt_s - \monelt_t$ belongs to the ideal generated by
  $H$, then 
  \begin{equation}
    \label{eq:mon-rewrite-red-membership}
    \monelt_s - \monelt_t 
    = 
    \sum_{i=1}^n a_i \monelt[n]_i (\gelem_i \cdot \monelt_i - \gelem_i \cdot \monelt'_i)
    \quad .
  \end{equation}

  Let us write the (finite) graph $G$ whose vertices are the monomials
  $\monelt[n] (\gelem_i \cdot \monelt_i)$ and $\monelt[n] (\gelem_i \cdot
  \monelt'_i)$, and whose edges are the directed weighted edges labelled by
  $a_i$ (in a direction that makes the weight positive).

  Let us now analyse \cref{eq:mon-rewrite-red-membership}, and notice that
  identifying monomials in the left and right-hand sides of the equation allows
  us to show that $\monelt_s$ and $\monelt_t$ are vertices of $G$. Furthermore,
  we deduce that the sum of the weights of the edges having $\monelt_s$ as a
  source or target equals $1$, and that the sum of the weights of the edges
  having $\monelt_t$ as a source or target equals $-1$. Finally, for every
  vertex $v$ of $G$ that is not $\monelt_s$ or $\monelt_t$, the sum of the
  weights of the edges having $v$ as a source or target is $0$, again because
  of an analysis of the coefficient of the monomial $v$ in the sum of
  \cref{eq:mon-rewrite-red-membership}.

  Hence, the graph $G$ is a flow network, with a flow value of at least $1$
  from $\monelt_s$ to $\monelt_t$. As a consequence, there must exist a path
  from $\monelt_s$ to $\monelt_t$ in $G$, which is a witness
  of the fact that 
  one can rewrite $\monelt_s$ into $\monelt_t$ using the rules of $R$.
\end{proof}

\paragraph{Reversible Turing Machines}
\AP In the presence of an infinite path, one can easily encode words, hence
configurations of a Turing machine, as monomials. However, because the
rewriting systems are reversible by nature, it will be easier for us to encode
the Halting problem for \emph{reversible} Turing machines \cite{BENN73}.
Given a reversible Turing machine $M$ over a binary alphabet, we will
create the following \kl{monomial rewrite system} $R_M$, composed of
four distinct phases:
\begin{enumerate}
  \item \label{item:undecidability-1}
    \textbf{Tape creation.} This phase creates a long monomial 
    of the form $x_0^{\mathsf{as}} x_1^{\mathsf{1}} \cdots x_{n-1}^{1} x_n^{\mathsf{ac}}$.
    It is obtained via rules of the form
    $x_0^{\mathsf{as}} x_i^{\mathsf{ac}} \leftrightarrow x_0^{\mathsf{as}} x_i^{1} x_{i+1}^{\mathsf{ac}}$
  \item \label{item:undecidability-2}
    \textbf{Linearity check.}
    This phase ensures that the tape is a long path, i.e., that the tape creation
    did not introduce a loop by reusing a variable name twice.
    It does so by using the well-known \emph{Floyd cycle-finding algorithm},
    which uses two pointers moving at different speeds.
    The two pointers are represented by exponents $\mathsf{bc1}$ and $\mathsf{bc2}$,
    and the rules are of the form
    $x_0^{\mathsf{bs}} x_i^{\mathsf{bc1}} x_{i+1}^1 x_j^{\mathsf{bc2}} x_{j+1}^1 x_{j+2}^1 x_n^{\mathsf{be}} \leftrightarrow 
     x_0^{\mathsf{bs}} x_i^{1} 
     x_{i+1}^{\mathsf{bc1}}
     x_j^{1} 
     x_{j+1}^{1} 
     x_{j+2}^{\mathsf{bc2}}
     x_{n}^{\mathsf{be}}$,
     whenever $x_j \neq x_i$.
  \item \label{item:undecidability-3}
    \textbf{Machine simulation.}
    This phase simulates the reversible Turing machine $M$ over the input monomial
    by using rules of the form
    $x_0^{\mathsf{cs}} x_0^{q} x_{i-1}^{a} x_i^{b} x_{i}^{\mathsf{cc}} x_{i+1}^{c}
    \leftrightarrow
    x_0^{\mathsf{cs}} x_0^{q'} x_{i-1}^{a} x_i^{b} x_{i}^{\mathsf{cc}} x_{i+1}^{c'}$,
    where $q,q'$ are the states of the Turing machine, and $a,b,c$ are letters
    on the tape.

  \item \label{item:undecidability-4}
    \textbf{Cleanup.}
    This phase cleans up the monomial, eating every variable that is 
    not the first one.
    $x_0^{\mathsf{ds}} y \leftrightarrow x_0^{\mathsf{ds}}$.
\end{enumerate}
Note that because of the usage of a distinguishing colour on the variable $x_0$,
the four phases described here cannot interact. Let us now add 
the following \emph{inter-phase} rules to the system:
\begin{enumerate}
  \setcounter{enumi}{4}
  \item \label{item:undecidability-5}
    \textbf{Tape creation to linearity check.}
    This single rule allows to non-deterministically
    switch from the tape creation phase to the linearity check phase.
    It is a rule of the form
    $x_0^{\mathsf{as}} x_1^{1} x_2^{1} x_n^{\mathsf{ac}} 
    \leftrightarrow
    x_0^{\mathsf{bs}} x_1^{\mathsf{bc1}} x_2^{\mathsf{bc2}} x_n^{\mathsf{be}}$.
  \item \label{item:undecidability-6}
    \textbf{Linearity check to machine simulation.}
    This rule allows switching from the linearity check phase to the machine
    simulation phase, and is of the form
    $x_0^{\mathsf{bs}} x_1 x_2 x_3 x_n^{\mathsf{bc2}} x_n^{\mathsf{be}} \leftrightarrow 
    x_0^{\mathsf{cs}} x_0^{q_0} x_1 x_2 x_2^{\mathsf{cc}} x_3 x_n^{\mathsf{ce}}$,
    where $q_0$ is the initial state of the Turing machine.
  \item \label{item:undecidability-7}
    \textbf{Machine simulation to cleanup.}
    This rule allows switching from the machine simulation phase to the cleanup
    phase, and is of the form
    $x_0^{\mathsf{cs}} x_0^{q_f}  x_n^{\mathsf{cc}} \leftrightarrow 
    x_0^{\mathsf{ds}}$.
\end{enumerate}

\begin{lemma}
  \label{lem:undecidability}
  Let $M$ be a reversible Turing machine, and let $R_M$ be the monomial rewrite
  system defined above. Then, 
  $x_0^{\mathsf{as}} x_1^{\mathsf{ac}} \leftrightarrow_{R_M}^* x_0^{\mathsf{ds}}$ if and only if
  $M$ halts on the empty word,
\end{lemma}
\begin{proof}

  The proof will be done by first showing that every rewriting from
  $x_0^{\mathsf{as}}$ to $x_0^{\mathsf{ds}}$ can be decomposed into four
  phases, and that each of these phases is correct. Note that the phase
  \ref{item:undecidability-1} creates a long sequence of variables by
  definition. And that the phase \ref{item:undecidability-2} is correct because
  of the correctness of the Floyd cycle-finding algorithm, but also is
  \emph{deterministic} ind \emph{co-deterministic} since it only moves pointers
  on the monomials. As a consequence, \ref{item:undecidability-2} does not
  interact with the other phases \ref{item:undecidability-1} and
  \ref{item:undecidability-3}, even in the presence of
  \ref{item:undecidability-5} and \ref{item:undecidability-6}.

  Similarly, the phase \ref{item:undecidability-3} is deterministic and
  co-deterministic, hence cannot influence the shape of the monomial,
  and only changes the (positive) exponents of its variables.

  Finally, let us remark that to enter phase \ref{item:undecidability-4}, one
  must have reached an accepting state in phase \ref{item:undecidability-3}.

  Hence, the only way to reach $x_0^{\mathsf{ds}}$ is to have reached an accepting
  state of the reversible Turing machine $M$, by simulating its computation
  starting from the empty word, over some (linear) tape.

  Conversely, if $M$ halts on the empty word, then there exists a maximal
  size for the working tape of $M$, and one can go through the four phases
  described above to reach $x_0^{\mathsf{ds}}$.
\end{proof}

\paragraph{Getting rid of colors.}
Now, let us argue that one can get rid of colors by using 
finitely many numbers to encode them. 
The first remark is that some colors (most) appear only once 
in the monomial and can be replaced by a unique (big) number.
The second remark is that the encoding of $u$ and $v$ can be interleaved
instead of using the same variables for both and distinguishing them
by their color. 




\subsection{Infinite Vector Space}
\label{subsec:vector}

Let us consider an infinite set $\mathbb{A}$ of atoms with equality, and the
infinite dimensional vector space $\mathbb{V}$ composed of equivariant
functions from $\mathbb{A}$ to $\K$. We set $\Indets = \mathbb{V}$, and
$\group$ is the group of all permutations of $\mathbb{A}$
lifted to $\mathbb{V}$.

Let us try to encode a path inside this structure. To that end, let us name the
elements of $\mathbb{A}$ as $a_i$ for $i \in \N$, and let us write $\delta_i$
for the function that maps $a_i$ to $1$ and all other atoms to $0$. We set $x_i
\defined \delta_i + \delta_{i+1}$, and $P \defined \seqof{x_i}[i \in \N]$.

Let us now consider an element $\gelem \in \group$ such that $\gelem \cdot P
\subseteq P$. Then, $x_0 = \delta_0 + \delta_1$ is mapped to some $x_n =
\delta_n + \delta_{n+1}$, but $\gelem \cdot x_0 = \delta_{\gelem 0} +
\delta_{\gelem 1}$, and therefore $\gelem 0 = n$ and $\gelem 1 = n + 1$. Now,
$\gelem \cdot x_1 = \delta_{\gelem 1} + \delta_{\gelem 2} = x_k$ for some $k$.
We conclude that $\gelem \cdot x_1 = \delta_{n + 1} + \delta_{n + 2} = x_{n +
1}$, and by induction that $\gelem \cdot x_i = x_{i + n}$ for all $i \in \N$.

As a consequence, the \kl{equivariant ideal membership problem} is undecidable
in this setting.


