%!TEX root = ../atomic.ieee.tex
% LTeX: language=en
\section{Undecidability Results}
\label{sec:undecidability}

In this section, we aim to show that the \kl{equivariant ideal membership
problem} is undecidable under the usual \kl{computability assumptions} on the
group action, when we do not assume that $(\mon{\Indets}, \gdivleq)$ is a
\kl{well-quasi-ordering}. In particular, this would show that computing
\kl{equivariant Gröbner bases} is not possible in these settings, proving the
optimality of our decidability \cref{thm:compute-egb}. Beware that there are
some pathological cases where the \kl{equivariant ideal membership problem} is
easily decidable, even when $(\mon{\Indets}, \gdivleq)$ is not a
well-quasi-ordering, as illustrated by the following
\cref{ex:non-wqo-undecidable}, and it is not possible to obtain such a
dichotomy result without further assumptions on the group action.

\begin{example}
  \label{ex:non-wqo-undecidable}
  Let $\Indets = \{x_1, x_2, \ldots\}$ be an infinite set of indeterminates,
  and let $\group$ be trivial group acting on $\Indets$.
  Then, the \kl{equivariant ideal membership problem} is decidable.
  Indeed, since the group is trivial, whenever one provides a finite set
  $H$ of generators of an \kl{equivariant ideal} $I$, one can
  in fact work in $\poly{\K}{V}$, where $V$ is the set of indeterminates
  that appear in $H$.
  Then, the \kl{equivariant ideal membership problem} reduces to 
  the \kl{ideal membership problem} in $\poly{\K}{V}$, which is decidable.
\end{example}


\AP However, we are able to prove the undecidability of the \kl{equivariant
ideal membership problem} under the assumption that the set of indeterminates
$\Indets$  contains an \intro(of){infinite path} $P \defined \seqof{x_i}[i \in
\N] \subseteq \Indets$, that is, a set of indeterminates such that $(x_i,x_j)
\in P^2$ is in the same orbit as $(x_0, x_1)$ if and only if $|i - j| = 1$, for
all $i,j \in \N$. We similarly define \reintro(of){finite paths} by considering
finitely many elements. The prototypical example of a set of indeterminates
containing an \kl(of){infinite path} is $\Indets = \Z$ equipped with the group
$\group$ of all shifts. The presence of an \kl(of){infinite path} clearly
prevents $(\mon{\Indets}, \gdivleq)$ from being a \kl{well-quasi-ordering}, as
shown by the following \cref{rem:not-wqo}. Furthermore, for indeterminates
obtained by considering \kl{homogeneous structures} and their automorphism
groups (\cref{sec:act ex}), the 
absence of an \kl(of){infinite path} has been
conjectured to be a necessary and sufficient condition for $(\mon{\Indets},
\gdivleq)$ to be a \kl{well-quasi-ordering}: this follows from a conjecture of
Schmitz restated in \cref{conj:wqo-infinite-path}, that generalises one of
Pouzet (\cref{rem:conj-wqo-pouzet}), as explained in
\cref{rem:conj-wqo-infinite-path}.


\begin{remark}
  \label{rem:not-wqo}
  Assume that $\Indets$ contains an \kl(of){infinite path}
  $P \defined \seqof{x_i}[i \in \N]$.
  Then, the set of monomials $\setof{x_0^3 x_1^1 \cdots x_{n-1}^1 x_n^2}{n \in \N}$
  is an infinite antichain in $(\mon{\Indets}, \gdivleq)$.
  Indeed, assume that there exists $n < m$, and a group element $\gelem \in \group$ such that
  $\gelem \cdot \monelt_n \divleq \monelt_m$.
  Then, $\gelem \cdot x_0 = x_0$, because it is the only indeterminate with 
  exponent $3$ in $\monelt_m$. Furthermore, 
  $\gelem \cdot (x_0,x_1) = (x_i,x_j)$ implies that 
  $|i - j| = 1$, and since $\gelem \cdot x_0 = x_0$, we conclude
  $\gelem \cdot x_1 = x_1$. By an immediate induction, we 
  conclude that $\gelem \cdot x_i = x_i$ for all $0 \leq i \leq n$,
  but then we also have that the degree of $\gelem \cdot x_n$ is less than $2$
  in $\monelt_m$, which contradicts the fact that $\gelem \cdot \monelt_n \divleq \monelt_m$.
\end{remark}

\begin{conjecture}[Schmitz]
  \label{conj:wqo-infinite-path}
  Let $\mathcal{C}$ be a class of finite relational structures. Then, the following are
  equivalent:
  \begin{enumerate}
    \item The class of structures of $\mathcal{C}$ labelled with 
      any \kl{well-quasi-ordered} set $(Y, \leq)$ is
      itself \kl{well-quasi-ordered} under the
      labelled-induced-substructure relation.
    \item For every existential formula $\varphi(x,y)$,
      there exists $N_\varphi \in \N$, such 
      that $\varphi$ does not \kl(efo){define paths} of length greater than $N_\varphi$
      in the structures of $\mathcal{C}$.
  \end{enumerate}
  Where a formula \intro(efo){defines a path} of length $n$ in a structure
  if there exists $n$ distinct elements $a_0, \ldots, a_{n-1}$ in the structure
  such that $\varphi(a_i, a_j)$ holds if and only if $|i - j| = 1$.
\end{conjecture}

\begin{remark}
  \label{rem:conj-wqo-pouzet}
  The conjecture of Schmitz is a generalization of Pouzet's conjecture
  \cite{POUZ72} that states that a class $\mathcal{C}$  of finite relational structures is
  \kl{well-quasi-ordered} under the labelled induced-substructure relation for
  every \kl{well-quasi-ordered} set of labels, 
  if and only if it is the case for the set of two incomparable labels
  \cite[Problem 9]{POUZ24}. A negative answer to Pouzet's conjecture
  has been obtained in \cite{KRTH90,KS91} for finite (non-relational) structures,
  but the conjecture remains open for finite relational structures.
\end{remark}

\begin{remark}
  \label{rem:conj-wqo-infinite-path}
  Let $\Indets$ be an infinite \kl{homogeneous structure},
  such that $(\mon{\Indets}, \gdivleq)$ is not a \kl{well-quasi-ordering}.
  Then, the collection of finite substructures of $\Indets$
  labelled by $(\N,\leq)$ is not \kl{well-quasi-ordered} under the
  labelled-induced-substructure relation.
  Hence, if one believes that \cref{conj:wqo-infinite-path} holds,
  there exists an existential formula $\varphi(x,y)$ such that
  $\varphi$ defines arbitrarily long paths in $\Indets$.
  Because $\Indets$ is \kl{homogeneous},
  this means that $\varphi$ defines an infinite path in $\Indets$,
  and in particular, 
  $\Indets$ contains an \kl(of){infinite path} $P$, as introduced
  for generic sets of indeterminates.
\end{remark}


As already mentioned in \cref{rem:conj-wqo-infinite-path}, it is conjectured
that the presence of an \kl(of){infinite path} is a necessary condition for the
\kl{equivariant ideal membership problem} to be undecidable in the case of
\kl{homogeneous structures} over relational signatures. Let us briefly argue
that in the case of \kl{homogeneous} \emph{$3$-graphs} $\mathcal{G}_3$ (i.e. a
structure with three distinct edge relations), the \emph{WQO dichotomy theorem}
\cite[Theorem 4]{LAPIO20}, exactly states that: either
$(\mon[Y]{\mathcal{G}_3}, \gdivleq)$ is a \kl{well-quasi-ordering} for all
\kl{well-quasi-ordered} sets $Y$, or there exists an \kl(of){infinite path} in
$\mathcal{G}_3$. We conclude that for \kl{homogeneous} \emph{$3$-graphs},
either the \kl{equivariant ideal membership problem} is undecidable
(\cref{thm:undecidable-paths}), or our \cref{thm:compute-egb} can be applied to
compute \kl{equivariant Gröbner bases}.

\paragraph{Monomial Reachability}
The undecidability results we will present in this section regarding the
\kl{equivariant ideal membership problem} will use the polynomials in a very
limited way: we will only need to consider \emph{monomials}, and there will
even be a bound on the maximal exponent used. Before going into the details of
our reductions, let us first introduce an intermediate problem that will be
easier to work with: the (equivariant) \kl{monomial reachability problem}. 

\begin{definition}
  \label{def:mon-rewrite-system}
  A \intro{monomial rewrite system} is a finite set of pairs of the form
  $\set{\monelt, \monelt'}$ where $\monelt, \monelt' \in \mon{\Indets}$.
  The \intro{monomial reachability problem} is the problem of deciding whether
  there exists a sequence of rewrites that transforms $\monelt_s$ into $\monelt_t$
  using the rules of a monomial rewrite system $R$, where
  a \intro(monrew){rewrite step} is a pair of the form
  \begin{equation*}
    \monelt[n] (\gelem \cdot \monelt)
    \leftrightarrow_R 
    \monelt[n] (\gelem \cdot \monelt')
    \text{ if } \set{\monelt, \monelt'} \in R
    \text{ and } \gelem \in \group
    \quad .
  \end{equation*}
\end{definition}

\begin{example}
  \label{ex:mon-rewrite-system}
  Let $\Indets = \N$ and $\group$ be the set of all bijections of $\Indets$.
  Then, the rewrite system $x_1^2 x_2^2 \leftrightarrow_R x_1^2$
  satisfies $\monelt \leftrightarrow_R^* x_1^2$ if and only if 
  $\monelt$ has all its exponents that are multiple of $2$.
\end{example}

The following \cref{lem:mon-rewrite-red-membership} shows that the \kl{monomial
reachability problem} can be reduced to the \kl{equivariant ideal membership
problem}, and follows the exact same reasoning as in the case of finitely many
indeterminates \cite{MAME82}. This reduction was also noticed in \cite[Theorem
64]{GHOLAS24}.


\begin{lemma}[label=lem:mon-rewrite-red-membership,restate=lem:mon-rewrite-red-membership]
  \AP
  Assuming that $\K = \mathbb{Q}$,
  one can solve the \kl{monomial reachability problem}
  provided that one can solve the \kl{equivariant ideal membership problem}.
  \proofref{lem:mon-rewrite-red-membership}
\end{lemma}

In order to show that the \kl{equivariant ideal membership problem} is
undecidable, it is therefore enough to show that the \kl{monomial reachability
problem} is undecidable. To that end, we will encode the Halting problem of a
Turing machine. There are two main obstacles to overcome: first, the
reversibility of the rewriting system, which can be (partially) solved by
considering a \emph{reversible version} of a \emph{deterministic} Turing
machines, as explained in \cite[Simulation by bidirected systems, p.
15]{GAMAPASCZE22}; and second, the fact that the configurations of the Turing
machine cannot staightforwardly be encoded as monomials due to the
commutativity of the multiplication.


\paragraph{Structures Containing Paths.} \AP Let us assume for the rest of this
section that $\Indets$ is a set of indeterminates that contains an
\kl(of){infinite path}, let us fix a binary alphabet $\Sigma \defined
\set{a,b}$. Given a \kl(of){finite path} $P \defined \seqof{x_i}[0 \leq i <
4n]$, we define a function $\intro*\wenc{ \cdot}_P \colon \Sigma^{\leq n} \to
\mon{\Indets}$, where $\Sigma$ is a finite alphabet, that \intro[word encoding]{encodes a word} $u \in
\Sigma^{\leq n}$ as a monomial. Namely, we define inductively
$\wenc{\varepsilon} \defined 1$, $\wenc{a u}_P = x_0^4 x_1^2 x_2^1 x_3^3
(\mathsf{shift}_{+4} \cdot \wenc{u}_P)$ and $\wenc{b u}_P = x_0^4 x_1^1 x_2^2
x_3^3 (\mathsf{shift}_{+4} \cdot \wenc{u}_P)$ for all $u \in \Sigma^*$, where
$\mathsf{shift}_{+k}$ acts on $P$ by shifting the indices by
$k$.\footnote{There may be no element $\gelem \in \group$ that acts like
$\mathsf{shift}_{+1}$, we only use it as a function.} Let us remark that
\kl{monomial rewriting} applied on \kl{word encodings} can simulate
(reversible) string rewriting on words of a given size.

\begin{lemma}[name={},restate=lem:word-encoding-string-subst]
  \label{lem:word-encoding-string-subst}
  Let $P,Q$ be two \kl(of){finite paths} in $\Indets$,
  such that $(p_0,p_1)$ is in the same orbit as 
  $(q_0,q_1)$.
  Let $u,v,w \in \Sigma^*$ be three words, such that $|u| = |v| \leq |w|$,
  and let $\monelt[n] \in \mon{\Indets}$ be a monomial.
  Assume that there exists $\gelem \in \group$
      such that $\wenc{w}_P = \monelt[m] (\gelem \cdot \wenc{u}_Q)$,
       $\monelt[n] = \monelt[m] (\gelem \cdot \wenc{v}_Q)$,
  and that $\wenc{w}_P$, $\wenc{u}_Q$ and $\wenc{v}_Q$
  are well-defined.
  Then,
      there exists $x, y \in \Sigma^*$
      such that $x u y = w$ and $\wenc{x v y}_P = \monelt[n]$.
  \proofref{lem:word-encoding-string-subst}
\end{lemma}


\Cref{lem:word-encoding-string-subst} shows that all encodings
using \kl(of){finite paths} with the same initial orbit are compatible with
each other for the purpose of \kl{monomial rewriting}. Let us now assume that
the alphabet is any finite set of letters, using a suitable unambiguous
encoding of the alphabet in binary \cite{BERST09}. This bigger alphabet size
will simplify the statement and proof of the following
\cref{lem:reversible-machine}, which explains how to simulate a
reversible Turing machine using \kl{monomial rewriting}. Given a reversible
Turing machine $M$ with a finite set $Q$ of states and tape alphabet $\Sigma$,
we will consider the following alphabet $\Gamma \defined \set{ \triangleleft,
  \triangleright } \times \set{ \text{pre}, \text{run}, \text{post} } \uplus Q
  \uplus \Sigma \uplus \set{ \square, \square_1, \square_2}$. The letter
  $\square$ is a blank symbol, and the letters $\triangleleft$ and
  $\triangleright$ are used to delimit the beginning and the end of the tape,
  with some extra ``phase information''. In a first \kl{monomial rewrite
  system}, we will encode a run of a reversible Turing machine $M$ on a fixed
  size input tape (\cref{lem:reversible-machine}), and in a second
  \kl{monomial rewrite system}, we will create a tape of arbitrary size
  (\cref{lem:tape-creation}). The union of these two \kl{monomial
  rewrite systems} will then be used to prove the undecidability of the
  \kl{equivariant ideal membership problem} in \cref{thm:undecidable-paths}.

\begin{lemma}[name={},restate=lem:reversible-machine]
  \label{lem:reversible-machine}
  Let us fix $(x_0, x_1)$ a pair of indeterminates.
  There exists a
  \kl{monomial rewrite system} $R_M$ such that the following
  are equivalent for every $n \geq 1$,
  and for any \kl(of){finite path} $P$ of length $4(n+2)$ 
  such that $(p_0, p_1)$ is in the same orbit as $(x_0, x_1)$:
  \begin{enumerate}
    \item $\wenc{ \triangleright^{\text{run}} q_0 \square^{n-1}
                  \triangleleft^{\text{run}}
     }_P \leftrightarrow_{R_M}^* 
     \wenc{ \triangleright^{\text{run}} q_f \square^{n-1}
                  \triangleleft^{\text{run}} }_P$,
      \item $M$ halts on the empty word using a tape bounded by $n-1$ cells.
  \end{enumerate}
  Furthermore, every monomial that is 
  reachable from $\wenc{ \triangleright^{\text{run}} q_0 \square^{n-1} \triangleleft^{\text{pre}} }_P$
  or $\wenc{ \triangleright^{\text{run}} q_f \square^{n-1} \triangleleft^{\text{run}} }_P$
  is the image of a word of the form
  $\wenc{\triangleright^{\text{run}} u \triangleleft^{\text{run}}}_P$  
  where $u \in (Q \uplus \Sigma \uplus \square)^n$.
  \proofref{lem:reversible-machine}
\end{lemma}


\Cref{lem:reversible-machine} shows that one can simulate the
runs, provided we know in advance the maximal size of the tape used by the
reversible Turing machine. The key ingredient that remains to be explained is
how one can start from a finite monomial $\monelt$ and create a tape of
arbitrary size using a \kl{monomial rewrite system}. The difficulty is that we
will not be able to ensure that we follow one specific \kl(of){finite path}
when creating the tape.

\begin{lemma}[name={},restate=lem:tape-creation]
  \label{lem:tape-creation}
  Let $(x_0, x_1)$ be a pair of indeterminates, $P$ be a \kl(of){finite path}
  such that $(p_0, p_1)$ is in the same orbit as $(x_0, x_1)$.
  There exists a \kl{monomial rewrite system} $R_\text{pre}$
  such that for every monomial $\monelt \in \mon{\Indets}$, the following are
  equivalent:
  \begin{enumerate}
    \item $\wenc{ \triangleright^{\text{pre}} \square \square_1 \square_2 \triangleleft^{\text{pre}}}_P
      \leftrightarrow_{R_\text{pre}}^* 
      \monelt$
      and $\wenc{\triangleright^{\text{run}}}_{P'}
      \gdivleq \monelt$ for some \kl(of){finite path} $P'$ such that
      $(p_0', p_1')$ is in the same orbit as $(x_0, x_1)$.
    \item There exists $n \geq 2$ and a \kl(of){finite path} $P'$ such that 
      $(p_0', p_1')$ is in the same orbit as $(x_0, x_1)$,
      and 
      $\monelt = \wenc{ \triangleright^{\text{run}} q_0 \square^{n}
      \triangleleft^{\text{run}} }_{P'}$.
  \end{enumerate}
  Similarly, there exists a \kl{monomial rewrite system} $R_\text{post}$
  with analogue properties using $q_f$ instead of $q_0$.
  \proofref{lem:tape-creation}
\end{lemma}


\csname thm:undecidable-paths\endcsname*
\begin{proof}
  It suffices to combine the rewriting systems $R_M$, $R_\text{pre}$ and 
  $R_\text{post}$ by taking their union.
\end{proof}


\begin{remark}
  \label{rem:multiple-orbits}
  The undecidability result of \cref{thm:undecidable-paths} can be generalised
  to a \emph{relaxed} notion of \kl(of){infinite path}. Given finitely
  many orbits $\mathcal{O}_1, \ldots, \mathcal{O}_k$ of pairs of
  indeterminates, a \emph{relaxed path} is a set of indeterminates 
  such that $(x_i, x_j)$ is belongs to one of the orbits $\mathcal{O}_k$
  if and only if $|i - j| = 1$ for all $i,j \in \N$.
\end{remark}

\begin{remark}[name={},restate=rem:indeterminates-infinite-path]
  \label{rem:indeterminates-infinite-path}
  Given an \kl{oligomorphic} set of indeterminates $\Indets$,
  it is equivalent to say that $\Indets$ contains an \kl(of){infinite path}
  or to say that it contains \kl(of){finite paths} of arbitrary length.
  \proofref{rem:indeterminates-infinite-path}
\end{remark}



\begin{example}
  \label{ex:rado-graph-path}
  The \kl{Rado graph}, as introduced in \cref{ex:rado},
  contains an \kl(of){infinite path} $P$. Indeed, the Rado graph
  contains every finite graph as an induced subgraph, and in particular,
  it contains arbitrarily long finite paths. 
  As a consequence of \cref{thm:undecidable-paths},
  which applies thanks to \cref{rem:indeterminates-infinite-path},
  we conclude that the \kl{equivariant ideal membership problem}
  is undecidable for the Rado graph.
\end{example}

\begin{example}[name={},restate=ex:product-indets]
  \label{ex:product-indets}
  Let $\Indets$ be an \kl{oligomorphic} infinite set of indeterminates.
  Then $\Indets \times \Indets$ contains a (generalised) \kl(of){infinite path}
  as defined in \cref{rem:multiple-orbits}.
  \proofref{ex:product-indets}
\end{example}


