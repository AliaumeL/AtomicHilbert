%!TEX root = ../atomic.asmart.tex
% LTeX: language=en
\section{Undecidability Results}
\label{sec:undecidability}

In this section, we aim to show that the \kl{equivariant ideal membership
problem} is undecidable under the usual \kl{effectiveness conditions} on the
group action, when we do not assume that $(\mon{\Indets}, \gdivleq)$ is a
\kl{well-quasi-ordering}. In particular, this would show that computing
\kl{equivariant Gr√∂bner bases} is not possible in these settings, proving the
optimality of our decidability
\cref{thm:compute-egb}.
Beware that there are some pathological cases where the \kl{equivariant ideal
membership problem} is easily decidable, even when $(\mon{\Indets}, \gdivleq)$
is not a well-quasi-ordering, as illustrated by the following
\cref{ex:non-wqo-undecidable}, and it is not possible to obtain
such a dichotomy result.

\begin{example}
  \label{ex:non-wqo-undecidable}
  Let $\Indets = \{x_1, x_2, \ldots\}$ be an infinite set of indeterminates,
  and let $\group$ be trivial group acting on $\Indets$.
  Then, the \kl{equivariant ideal membership problem} is decidable.
  Indeed, since the group is trivial, whenever one provides a finite set
  $H$ of generators of an \kl{equivariant ideal} $I$, one can
  in fact work in $\poly{\K}{V}$, where $V$ is the set of indeterminates
  that appear in $H$.
  Then, the \kl{equivariant ideal membership problem} is reduces to 
  the \kl{ideal membership problem} in $\poly{\K}{V}$, which is decidable.
\end{example}


\AP However, one we are able to prove the undecidability of the \kl{equivariant
ideal membership problem} under the assumption that the set of indeterminates
$\Indets$  contains an \intro(of){infinite path} $P \defined \seqof{x_i}[i \in
\N] \subseteq \Indets$, that is, a set of indeterminates such that $(x_i,x_j)
\in P^2$ is in the same orbit as $(x_0, x_1)$ if and only if $|i - j| = 1$, for
all $i,j \in \N$. We similarly define \reintro(of){finite paths} by considering
finitely many elements. The prototypical example of a set of indeterminates
containing an \kl(of){infinite path} is $\Indets = \Z$ equipped with the group
$\group$ of all shifts. The presence of an \kl(of){infinite path} clearly
prevents $(\mon{\Indets}, \gdivleq)$ from being a \kl{well-quasi-ordering}, as
shown by the following \cref{rem:not-wqo}. Furthermore, for
indeterminates obtained by considering \kl{homogeneous structures} and their
automorphism groups
(\cref{sec:examples}),
the presence of an \kl(of){infinite path} has been conjectured to be a
necessary and sufficient condition for $(\mon{\Indets}, \gdivleq)$ to be a
\kl{well-quasi-ordering}: this follows from a conjecture of Schmitz restated in
\cref{conj:wqo-infinite-path}, that generalises one
of Pouzet (\cref{rem:conj-wqo-pouzet}), as explained in
\cref{rem:conj-wqo-infinite-path}.


\begin{remark}
  \label{rem:not-wqo}
  Assume that $\Indets$ contains an \kl(of){infinite path}
  $P \defined \seqof{x_i}[i \in \N]$.
  Then, the set of monomials $\setof{x_0^3 x_1^1 \cdots x_{n-1}^1 x_n^2}{n \in \N}$
  is an infinite antichain in $(\mon{\Indets}, \gdivleq)$.
  Indeed, assume that there exists $n < m$, and a group element $\gelem \in \group$ such that
  $\gelem \cdot \monelt_n \divleq \monelt_m$.
  Then, $\gelem \cdot x_0 = x_0$, because it is the only indeterminate with 
  exponent $3$ in $\monelt_m$. Furthermore, 
  $\gelem \cdot (x_0,x_1) = (x_i,x_j)$ implies that 
  $|i - j| = 1$, and since $\gelem \cdot x_0 = x_0$, we conclude
  $\gelem \cdot x_1 = x_1$. By an immediate induction, we 
  conclude that $\gelem \cdot x_i = x_i$ for all $0 \leq i \leq n$,
  but then we also have that the degree of $\gelem \cdot x_n$ is less than $2$
  in $\monelt_m$, which contradicts the fact that $\gelem \cdot \monelt_n \divleq \monelt_m$.
\end{remark}

\begin{conjecture}[Schmitz]
  \label{conj:wqo-infinite-path}
  Let $\mathcal{C}$ be a class of finite structures. Then, the following are
  equivalent:
  \begin{enumerate}
    \item The class of structures of $\mathcal{C}$ labelled with 
      any \kl{well-quasi-ordered} set $(Y, \leq)$ is
      itself \kl{well-quasi-ordered} under the
      labelled-induced-substructure relation.
    \item For every existential formula $\varphi(x,y)$,
      there exists $N_\varphi \in \N$, such 
      that $\varphi$ does not \kl(efo){define paths} of length greater than $N_\varphi$
      in the structures of $\mathcal{C}$.
  \end{enumerate}
  Where a formula \intro(efo){defines a path} of length $n$ in a structure
  if there exists $n$ distinct elements $a_0, \ldots, a_{n-1}$ in the structure
  such that $\varphi(a_i, a_j)$ holds if and only if $|i - j| = 1$.
\end{conjecture}

\begin{remark}
  \label{rem:conj-wqo-pouzet}
  The conjecture of Schmitz is a generalization of Pouzet's conjecture
  \cite{POUZ72} that states that the class of finite structures is
  \kl{well-quasi-ordered} under the labelled-induced-substructure relation if and
  it is for two labels.
\end{remark}

\begin{remark}
  \label{rem:conj-wqo-infinite-path}
  Let $\Indets$ be an infinite \kl{homogeneous structure},
  such that $(\mon{\Indets}, \gdivleq)$ is not a \kl{well-quasi-ordering}.
  Then, the collection of finite substructures of $\Indets$
  labelled by $(\N,\leq)$ is not \kl{well-quasi-ordered} under the
  labelled-induced-substructure relation.
  Hence, if one believes that \cref{conj:wqo-infinite-path} holds,
  there exists an existential formula $\varphi(x,y)$ such that
  $\varphi$ defines arbitrarily long paths in $\Indets$.
  Because $\Indets$ is \kl{homogeneous}, and $\varphi$ is existential,
  this means that $\varphi$ defines an infinite path in $\Indets$,
  and in particular, 
  $\Indets$ contains an \kl(of){infinite path} $P$, as introduced
  for generic sets of indeterminates.
\end{remark}

\paragraph{Monomial Reachability}
The undecidability results we will present in this section regarding the
\kl{equivariant ideal membership problem} will use the polynomials in a very
limited way: we will only need to consider \emph{monomials}, and there will
even be a bound on the maximal exponent used. Before going into the details of
our reductions, let us first introduce an intermediate problem that will be
easier to work with: the (equivariant) \kl{monomial reachability problem}. 

\begin{definition}
  \label{def:mon-rewrite-system}
  A \intro{monomial rewrite system} is a finite set of pairs of the form
  $\set{\monelt, \monelt'}$ where $\monelt, \monelt' \in \mon{\Indets}$.
  The \intro{monomial reachability problem} is the problem of deciding whether
  there exists a sequence of rewrites that transforms $\monelt_s$ into $\monelt_t$
  using the rules of a monomial rewrite system $R$, where
  a \intro(monrew){rewrite step} is a pair of the form
  \begin{equation*}
    \monelt[n] (\gelem \cdot \monelt)
    \leftrightarrow_R 
    \monelt[n] (\gelem \cdot \monelt')
    \text{ if } \set{\monelt, \monelt'} \in R
    \text{ and } \gelem \in \group
    \quad .
  \end{equation*}
\end{definition}

\begin{example}
  \label{ex:mon-rewrite-system}
  Let $\Indets = \N$ and $\group$ be the set of all bijections of $\Indets$.
  Then, the rewrite system $x_1^2 x_2^2 \leftrightarrow_R x_1^2$
  satisfies $\monelt \leftrightarrow_R^* x_1^2$ if and only if 
  $\monelt$ has all its exponents that are multiple of $2$.
\end{example}

The following \cref{lem:mon-rewrite-red-membership} shows that the \kl{monomial
reachability problem} can be reduced to the \kl{equivariant ideal membership
problem}, and follows the exact same reasoning as in the case of finitely many
indeterminates \cite{MAME82}. This reduction was also noticed in \cite[Theorem
64]{GHOLAS24}.


\begin{lemma}[label=lem:mon-rewrite-red-membership,ref=lem:mon-rewrite-red-membership]
  One can solve the \kl{monomial reachability problem}
  provided that one can solve the \kl{equivariant ideal membership problem}.
\end{lemma}

In order to show that the \kl{equivariant ideal membership problem} is
undecidable, it is therefore enough to show that the \kl{monomial reachability
problem} is undecidable. To that end, we will encode the Halting problem of a
Turing machine. There are two main obstacles to overcome: first, the
reversibility of the rewriting system, which can be (partially) solved by
considering \emph{reversible} Turing machines; and second, the fact that the
configurations of the Turing machine cannot staightforwardly be encoded as
monomials due to the commutativity of the multiplication.
To overcome the second issue, we will use the following notion of 
\kl{word encoding}.

\paragraph{Structures Containing Paths.}
\AP
Let us assume for the rest of this section 
that $\Indets$ is a set of indeterminates that contains an
\kl(of){infinite path} $P \defined \seqof{x_i}[i \in \N]$,
and 
let us fix a binary alphabet $\Sigma \defined \set{a,b}$, and let us define
a function $\intro*\wenc{ \cdot} \colon \Sigma^* \to \mon{\Indets}$, where
$\Sigma$ is a finite alphabet, that encodes a word $u \in \Sigma^*$ as a
monomial. Namely, we define inductively $\wenc{\varepsilon} \defined 1$,
$\wenc{a u} = x_0^3 x_1^2 x_2^1 x_3^3 (\gelem_{+4} \cdot \wenc{u})$ and
$\wenc{b u} = x_0^3 x_1^1 x_2^2 x_3^3 (\gelem_{+4} \cdot \wenc{u})$ for all $u
\in \Sigma^*$. Let us remark that \kl{monomial rewriting} applied on \kl{word
encodings} can simulate (reversible) string rewriting on words of a given size.

\begin{lemma}
  \label{lem:word-encoding-string-subst}
  Let $u,v,w \in \Sigma^*$ be three words, such that $|u| = |v|$,
  and let $\monelt[n] \in \mon{\Indets}$ be a monomial.
  The following are equivalent:
  \begin{enumerate}
    \item \label{item:rewrite-submonomial} 
      There exists $\gelem \in \group$
      such that $\wenc{w} = \monelt[m] (\gelem \cdot \wenc{u})$
      and $\monelt[n] = \monelt[m] (\gelem \cdot \wenc{v})$,
    \item \label{item:rewrite-subword}
      There exists $x, y \in \Sigma^*$
      such that $x u y = w$ and $\wenc{x v y} = \monelt[n]$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  Let us prove \cref{item:rewrite-submonomial} implies
  \cref{item:rewrite-subword}. To that end,
  let $\gelem \in \group$ be such that
  $\wenc{w} = \monelt[m] (\gelem \cdot \wenc{u})$ and
  $\monelt[n] = \monelt[m] (\gelem \cdot \wenc{v})$.
  Then, $(\gelem \cdot \wenc{u}) = (\gelem_{+k} \cdot \wenc{u})$ 
  for some $z \in \Z$
  since $P$ is an \kl(of){infinite path}.
  Furthermore, $u$ and $v$ have the same length, hence
  the same indeterminates, and we conclude that
  $(\gelem \cdot \wenc{v}) =
   (\gelem_{+k} \cdot \wenc{v})$.
  Because letters encoding start and end with an exponent $3$,
  we conclude that $k = 4 \times \ell$, and therefore
  that $\wenc{w} = \wenc{x} (\gelem_{+k} \cdot \wenc{u})
  (\gelem_{+(k + 4|u|)} \cdot \wenc{y})$.
  As a consequence,
  $\wenc{x v y} = \monelt[n]$.

  Conversely, let us prove that \cref{item:rewrite-subword} implies
  \cref{item:rewrite-submonomial}. To that end, let $x, y \in \Sigma^*$ be such
  that $x u y = w$ and $\wenc{x v y} = \monelt[n]$. Then, we can write
  $\wenc{w} = \wenc{x} (\gelem_{+k} \cdot \wenc{u}) (\gelem_{+(k + 4|u|)} \cdot
  \wenc{y})$. Let us define $\monelt[m] \defined \wenc{x} (\gelem_{+(k +
  4\times|u|)} \cdot \wenc{y})$. It is clear that $\wenc{w} = \monelt[m]
  (\gelem_{+k} \cdot \wenc{u})$, and we can also notice that $\monelt[n] =
  \wenc{x v y} = \monelt[m] (\gelem_{+(k + 4|u|)} \cdot \wenc{v})$.
\end{proof}

Note that without loss of generality, thanks to
\cref{lem:word-encoding-string-subst}, we can assume that the alphabet is any
finite set of letters, using a suitable unambiguous encoding of the alphabet
in binary \cite{BERST09}. This bigger alphabet size will simplify
the statement and proof of the following \cref{lem:reversible-machine}, which
explains how to simulate a reversible Turing machine using \kl{monomial
rewriting}. Given a reversible Turing machine $M$ with a finite set $Q$ of
states and tape alphabet $\Sigma$, we will consider the following alphabet
$\Gamma \defined \set{ \triangleleft, \triangleright } \times \set{ \text{pre},
\text{run}, \text{post} } \uplus Q \uplus \Sigma \uplus \set{ \square,
\square_1, \square_2}$. The letter $\square$ is a blank symbol, and the letters
$\triangleleft$ and $\triangleright$ are used to delimit the beginning and the
end of the tape, with some extra ``phase information''. In a first \kl{monomial
rewrite system}, we will encode a run of a reversible Turing machine $M$ on a
fixed size input tape (\cref{lem:reversible-machine}), and in a second
\kl{monomial rewrite system}, we will create a tape of arbitrary size
(\cref{lem:tape-creation}). The union of these two \kl{monomial rewrite
systems} will then be used to prove the undecidability of the \kl{equivariant
ideal membership problem} in \cref{thm:undecidable-paths}.

\begin{lemma}
  \label{lem:reversible-machine}
  There exists a
  \kl{monomial rewrite system} $R_M$ such that the following
  are equivalent for every $n \geq 1$:
  \begin{enumerate}
    \item $\wenc{ \triangleright^{\text{pre}} \square^n 
                  \triangleleft^{\text{pre}}
     } \leftrightarrow_{R_M}^* 
     \wenc{ \triangleright^{\text{post}} \square^n 
                  \triangleleft^{\text{post}} }$,
      \item $M$ halts on the empty word using a tape bounded by $n-1$ cells.
  \end{enumerate}
  Furthermore, every monomial that is 
  reachable from $\wenc{ \triangleright^{\text{pre}} \square^n \triangleleft^{\text{pre}} }$
  or $\wenc{ \triangleright^{\text{post}} \square^n \triangleleft^{\text{post}} }$
  is the image of a word of the form
  $\wenc{\triangleright^{\text{run}} u \triangleleft^{\text{run}}}$  
  where $u \in (Q \uplus \Sigma \uplus \square)^n$.
\end{lemma}
\begin{proof}
  The rewrite system simply acts on the tape of the reversible Turing machine 
  using blank symbols. Because transitions of the reversible Turing machine
  are substitutions of strings having the same size if one does not create new
  tape cells, the rewriting system can straigthforwardly simulate the 
  substitutions because of \cref{lem:word-encoding-string-subst}.
  To this monomial rewriting system, we add two rules,
  respectively of the form
  $\wenc{ \triangleright^{\text{pre}} \square^n \triangleleft^{\text{pre}} }
  \leftrightarrow_{R_M}^*
  \wenc{ \triangleright^{\text{run}} q_0 \square^{n-1} \triangleleft^{\text{run}} }$
  and 
  $\wenc{ \triangleright^{\text{post}} \square^n \triangleleft^{\text{post}} }
  \leftrightarrow_{R_M}^*
  \wenc{ \triangleright^{\text{run}} q_f \square^{n-1} \triangleleft^{\text{run}} }$,
  where $q_0$ is the initial state of the Turing machine $M$ and $q_f$ is its
  final state.
  This is not problematic because one can 
  simply write $\wenc{\triangleright^{\text{run}} q_0} (\gelem \cdot \wenc{\triangleleft^{\text{run}}})$
  for a suitable $\gelem \in \group$, in order
  to ignore the number of blank symbols in the tape,
  and because we can assume that the reversible Turing machine
  starts with a clean tape and ends with a clean tape.
\end{proof}

\Cref{lem:reversible-machine} shows that one can simulate the runs, provided we
know in advance the maximal size of the tape used by the reversible Turing
machine. The key ingredient that remains to be explained is how one can start
from a finite monomial $\monelt$ and create a tape of arbitrary size using a
\kl{monomial rewrite system}. Note that because the set of indeterminates can
very well contain multiple copies of an \kl(of){infinite path} $P$, we will not
be able to guarantee that we create exactly the tape $\wenc{
\triangleright^{\text{pre}} \square^n \triangleleft^{\text{pre}} }$ for some $n
\in \N$, but rather that we can find some equivalent monomial up to the action
of $\group$.

\begin{lemma}
  \label{lem:tape-creation}
  There exists a \kl{monomial rewrite system} $R_\text{pre}$
  such that for every monomial $\monelt \in \mon{\Indets}$, the following are
  equivalent:
  \begin{enumerate}
    \item $\wenc{ \triangleright^{\text{pre}} \square \triangleleft^{\text{pre}}} 
      \leftrightarrow_{R_\text{pre}}^* 
      \monelt$
    \item there exists $n \in \N$ and $\gelem \in \group$, such that
      $\gelem \cdot \monelt = \wenc{ \triangleright^{\text{pre}} \square^n 
                        \triangleleft^{\text{pre}} }$.
  \end{enumerate}
  Similarly, there exists a \kl{monomial rewrite system} $R_\text{post}$
  with analogue properties.
\end{lemma}
\begin{proof}
  The rewrite system is going to have two phases.
  In a first phase, we will consider the rules
  $\wenc{ \square \triangleleft^{\text{pre}} } \leftrightarrow_{R_\text{pre}}
   \wenc{ \square \square \triangleleft^{\text{pre}} }$.
  This is \emph{almost} leading to the desired \kl{word encoding}.
  The only thing left to check is that we do not reuse indeterminates when 
  creating new letters.
  To ensure that we did not, we will implement the 
  Floyd cycle-finding algorithm, which uses two pointers moving at different speeds.
  To that end, we will use two new blank symbols $\square_1$ and $\square_2$,
  and the rules 
  $\wenc{ \square_1 \square } ( \gelem \cdot \wenc{ \square_2 \square \square })
  \leftrightarrow_{R_\text{pre}}
  \wenc{ \square \square_1 } (\gelem \cdot \wenc{ \square \square \square_2 })$,
  where $\pi$ is a permutation of the indeterminates that ensures that the
  indetermitates of the two words are distinct.
  Finally, one adds the possibility to switch to the second phase,
  and end the second phase when pointer $\square_2$ reaches the end of the tape.

  \todo[inline]{Aliaume: complete the proof}
\end{proof}

\csname thm:undecidable-paths\endcsname*
\begin{proof}
  It suffices to combine the rewriting systems $R_M$, $R_\text{pre}$ and 
  $R_\text{post}$ by taking their union.
\end{proof}


\begin{remark}
  \label{rem:more-generally}
  The undecidability result of \cref{cor:undecidability} can be generalized to
  any set of indeterminates in which one can encode words over a binary alphabet,
  and for which there is a \kl{monomial rewrite system} that can
  produce arbitrary long words.
  We strongly conjecture that this is the case for 
  the \kl{infinite dimensional vector space}
  \todo{cite ref}
\end{remark}
